<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="cw-options-list.html">

<!--
A tagging/tokenizing input a la http://harvesthq.github.io/chosen/,
http://loopj.com/jquery-tokeninput/, and
http://sliptree.github.io/bootstrap-tokenfield/.

##### Example

    <cw-token-field placeholder="Choose a color...">
      <option value="red">Red</option>
      <option value="green">Green</option>
      <option value="blue">Blue</option>
    </cw-token-field>

@element cw-token-field
@blurb A tagging/tokenizing input.
@status alpha
@url cletusw.github.io/cw-token-field
-->
<polymer-element name="cw-token-field" attributes="placeholder"
    on-tap="{{onTap}}">

  <template>

    <link href="cw-token-field.css" rel="stylesheet">

    <template repeat="{{selected}}">
      <span class="selected">{{text}} <span class="unselect" on-tap="{{unselect}}">x</span></span>
    </template>
    <input id="filter" type="text" value="{{filterText}}" placeholder="{{_placeholder}}">
    <cw-options-list filterText="{{filterText}}" options="{{options}}" field="text" selected="{{selected}}" on-tap="{{onOptionsTap}}"></cw-options-list>

  </template>

  <script>

    Polymer({

      /**
       * The `noevent` event is not actually fired from here,
       * we document it as an example of documenting events.
       *
       * @event noevent
       */

      _placeholder: '',

      /**
       * The `placeholder` attribute contains text to display when nothing
       * is selected.
       *
       * @attribute placeholder
       * @type String
       */
      placeholder: '',

      attached: function() {
        this.options = Array.prototype.map.call(this.children, function(child) {
          return {
            selected: false,
            text: child.text,
            value: child.value
          }
        });
      },

      onOptionsTap: function() {
        this.filterText = '';
      },

      onTap: function() {
        this.$.filter.focus();
      },

      placeholderChanged: function() {
        this.selectedChanged();
      },

      selectedChanged: function() {
        if (this.selected && this.selected.length > 0) {
          this._placeholder = '';
        }
        else {
          this._placeholder = this.placeholder;
        }
      },

      unselect: function(event, detail, sender) {
        console.dir(sender);
      },

      /**
       * The `task` method does no work at this time.
       *
       * @method task
       * @return {Object} Returns undefined.
       * @param {String} dummy Serves no purpose today.
       */
      task: function(dummy) {
      }

    });

  </script>

</polymer-element>
